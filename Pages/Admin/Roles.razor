@page "/Admin/Roles"
@layout MainLayout
@inject RolesService _rolesService


<DataGrid Config="RoleDataGridConfig" />

@code {
    public DataGridConfig RoleDataGridConfig { get; set; }
    protected override async Task OnInitializedAsync()
    {
        RoleDataGridConfig = new DataGridConfig();
        RoleDataGridConfig.Title = "لیست نقش ها";
        RoleDataGridConfig.GroupActions = new List<DataGridRowActionGroup>
        {
            new DataGridRowActionGroup
            {
                Width = "200px",
                Actions = new List<DataGridRowAction>
                {
                    new DataGridRowAction
                    {
                        ButtonClass = ButtonsClass.btn_primary,
                        IconClass=IconsClass.fa_pen_to_square,
                        OnClick = (rowitem) =>
                        {

                        }
                    }
                }
            }
        };

        RoleDataGridConfig.Columns = new List<DataGridColumn>
        {
            new DataGridColumn
            {
                PropertyName = "Title",
                Title = "عنوان"
            },
            new DataGridColumn
            {
                PropertyName = "Id",
                Title = "شناسه"
            }
        };
        RoleDataGridConfig.LoadDataAsync = () =>
        {
            return Task.FromResult(_rolesService.Read().Cast<dynamic>().ToList());
        };
        RoleDataGridConfig.DeleteRowButtonDataGridConfig.OnOpenModal = (row) =>
        {
            return new ConfirmModal
                {
                    Title = "هشدار",
                    Content = "ایا از حذف این سطر مطمئن هستید؟",
                    OnConfirm = () =>
        {
                    _rolesService.Delete(Convert.ToInt32(row["Id"]));
                }
                };
        };
        RoleDataGridConfig.EditRowButtonDataGridConfig.OnOpenModal = (row) =>
        {
            return new InputModal
                {
                    OnSubmit = (form) =>
        {
                    var Role = new Role
                    {
                        Title = form["Title"]
                    };
                    _rolesService.Update(form["Id"].ToInt32(), Role);
                    return true;
                },
                    Fields = new List<ItemField>
                                                {
                                new ItemField
                                {
                                    PropertyName = "Id",
                                    Title = "شناسه",
                                    Value = row["Id"],
                                    ValuType = ModelEditorValueType.Text
                                },
                                new ItemField
                                {
                                    PropertyName = "Title",
                                    Title = "عنوان",
                                    Value = row["Title"],
                                    ValuType = ModelEditorValueType.Text
                                },
                                new SelectiveItemField
                                {
                                    PropertyName = "User",
                                    Title = "کاربر",
ValuType = ModelEditorValueType.Selective,
Items = new List<SelectItem>
{
        new SelectItem { Id = 1, Title = "مشهد" },
        new SelectItem { Id = 2, Title = "تهران" },
        new SelectItem { Id = 3, Title = "اصفهان" },
        new SelectItem { Id = 4, Title = "شیراز" },
}
                                },
                                                }
                };
        };
        RoleDataGridConfig.NewRowButtonDataGridConfig = new NewRowButtonDataGridConfig
            {
                ButtonTitle = "نقش جدید",
                IsShow = true,
                OnOpenModal = () =>
                {
                    return new InputModal
                    {
                        Fields = new List<ItemField>
                            {
                                new ItemField
                                {
                                    PropertyName = "Title",
                                    Title = "عنوان"
                                },
                                new SelectiveItemField
                                {
                                    PropertyName = "User",
                                    Title = "کاربر",
ValuType = ModelEditorValueType.Selective,
Items = new List<SelectItem>
{
        new SelectItem { Id = 1, Title = "مشهد" },
        new SelectItem { Id = 2, Title = "تهران" },
        new SelectItem { Id = 3, Title = "اصفهان" },
        new SelectItem { Id = 4, Title = "شیراز" },
}
                                },
                            },
                        OnSubmit = (form) =>
                        {
                            var Role = new Role
                            {
                                Title = form["Title"]
                            };
                            _rolesService.Create(Role);
                            return true;
                        }
                    };
                }
            };

    }
}
