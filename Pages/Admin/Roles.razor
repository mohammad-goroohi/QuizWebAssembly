@page "/Admin/Roles"
@layout MainLayout
@inject RolesService _rolesService


<DataGrid Config="RoleDataGridConfig" />

@code {
    public DataGridConfig RoleDataGridConfig { get; set; }
    protected override async Task OnInitializedAsync()
    {
        RoleDataGridConfig = new DataGridConfig();
        RoleDataGridConfig.Title = "لیست نقش ها";
        RoleDataGridConfig.GroupActions = new List<DataGridRowActionGroup>
        {
            new DataGridRowActionGroup
            {
                Width = "200px",
                Actions = new List<DataGridRowAction>
                {
                    new DataGridRowAction
                    {
                        ButtonClass = ButtonsClass.btn_primary,
                        IconClass=IconsClass.fa_pen_to_square,
                        OnClick = (rowitem) =>
                        {

                        }
                    }
                }
            }
        };

        RoleDataGridConfig.Columns = new List<DataGridColumn>
        {
            new DataGridColumn
            {
                PropertyName = "Title",
                Title = "عنوان"
            },
            new DataGridColumn
            {
                PropertyName = "Id",
                Title = "شناسه"
            }
        };
        RoleDataGridConfig.LoadDataAsync = () =>
        {
            return Task.FromResult(_rolesService.Read().Cast<dynamic>().ToList());
        };
        RoleDataGridConfig.DeleteRowButtonDataGridConfig.OnOpenModal = (row) =>
        {
            return new ConfirmModal
                {
                    Title = "هشدار",
                    Content = "ایا از حذف این سطر مطمئن هستید؟",
                    OnConfirm = () =>
    {
                _rolesService.Delete(Convert.ToInt32(row["Id"]));
            }
                };
        };
        RoleDataGridConfig.EditRowButtonDataGridConfig.OnOpenModal = (row) =>
        {
            return new InputModal
                {
                    Title = "ویرایش نقش",
                    ColumnCount = 1,
                    Size = ModalSize.modal_xl,
                    OnSubmit = (form) =>
    {
                var Role = new Role
                {
                    Id = form["Id"].ToInt32(),
                    Title = form["Title"]
                };
            _rolesService.Update(Role.Id, Role);
                return true;
            },
                    Fields = new List<ItemField>
                                                    {
                                new ItemField
                                {
                                    PropertyName = "Id",
                                    Title = "شناسه",
                                    Value = row["Id"],
                                    ValuType = ModelEditorValueType.Readonly
                                },
                                new ItemField
                                {
                                    PropertyName = "Title",
                                    Title = "عنوان",
                                    Value = row["Title"],
                                    ValuType = ModelEditorValueType.Text
                                }
                                                    }
                };
        };
        RoleDataGridConfig.NewRowButtonDataGridConfig = new NewRowButtonDataGridConfig
            {
                ButtonTitle = "نقش جدید",
                IsShow = true,
                OnOpenModal = () =>
                {
                    return new InputModal
                    {
                        Title = "ایجاد نقش",
                        ColumnCount = 1,
                        Size = ModalSize.modal_xl,
                        Fields = new List<ItemField>
                            {
                                new ItemField
                                {
                                    PropertyName = "Title",
                                    Title = "عنوان",
                                    ValidationRules = new List<ValidationItemField>
                                    {
                                        new Required
                                        {
                                            ErrorMessage = "اجباری",
                                        }
                                    }
                                }
                            },
                        OnSubmit = (form) =>
                        {
                            var Role = new Role
                            {
                                Title = form["Title"]
                            };
                            _rolesService.Create(Role);
                            return true;
                        }
                    };
                }
            };

    }
}
