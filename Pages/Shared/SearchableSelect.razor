<div class="position-relative" @onclick:stopPropagation="true">

    <!-- Input box -->
    <input class="form-control"
           placeholder="جستجو..."
           @onclick="ToggleDropdown"
           @onfocusout="ToggleDropdown"
           @bind="SearchText"
           @bind:event="oninput" />

    <!-- Dropdown -->
    @if (IsOpen)
    {
        <div class="border rounded bg-white position-absolute w-100 mt-1 shadow-sm"
             style="z-index: 1050; max-height: 200px; overflow-y: auto;">

            @foreach (var item in FilteredItems)
            {
                <div class="px-2 py-1"
                     style="cursor: pointer;"
                     @onclick="() => SelectItem(item)">
                    @item.Title
                </div>
            }

            @if (!FilteredItems.Any())
            {
                <div class="px-2 py-2 text-muted text-center">
                    موردی یافت نشد
                </div>
            }
        </div>
    }
</div>

@code {

    [Parameter] public List<SelectItem> Items { get; set; } = new();
    [Parameter] public int? Value { get; set; }
    [Parameter] public EventCallback<int?> ValueChanged { get; set; }

    protected bool IsOpen { get; set; }
    protected string SearchText { get; set; } = "";

    protected IEnumerable<SelectItem> FilteredItems =>
        string.IsNullOrWhiteSpace(SearchText)
            ? Items
            : Items.Where(i => i.Title.Contains(SearchText, StringComparison.OrdinalIgnoreCase));

    protected void ToggleDropdown()
    {
        IsOpen = !IsOpen;
    }

    protected async Task SelectItem(SelectItem item)
    {
        Value = item.Id;
        SearchText = item.Title;
        IsOpen = false;

        await ValueChanged.InvokeAsync(Value);
    }
}